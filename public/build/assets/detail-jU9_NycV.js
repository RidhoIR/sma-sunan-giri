import{r as m,j as a,H as S,L as v,c as P}from"./app-Coh28GkN.js";import{d as y,f as o,B as N}from"./button-DWWnqr2n.js";import{C as R}from"./card-BCRZtXkA.js";import{T as x,a as h,b as r,c as e,d as C,f as g}from"./table-CLnJY92L.js";import{A as O}from"./app-layout-DxwWa6ki.js";import{P as B}from"./printer-DJb5iIxJ.js";/* empty css            */import"./index-HB87p0Ve.js";import"./index-CtC4mkRX.js";import"./index-BmfNfoHw.js";import"./x-DU0VxgT_.js";import"./index-CDQHmKfo.js";import"./index-C77Ne_n3.js";import"./index-D6m8-lop.js";import"./chevrons-up-down-BAVBRCdf.js";import"./route-layout-CLvlloRf.js";const E=[{title:"Detail Tagihan",href:"/wali/detail-tagihan"}],Q=({tagihan_details:i,tagihan_detail:s,bank_sekolah:f,totalDibayar:k,sisaBayar:w})=>{const[p,u]=m.useState(!1),[j,b]=m.useState(!1);m.useEffect(()=>{if(document.getElementById("snap-midtrans"))b(!0);else{const n=document.createElement("script");n.id="snap-midtrans",n.src="https://app.sandbox.midtrans.com/snap/snap.js",n.setAttribute("data-client-key",void 0),n.onload=()=>{console.log("Snap script loaded successfully"),b(!0)},n.onerror=()=>{console.error("Failed to load Snap script")},document.body.appendChild(n)}},[]);const T=async()=>{try{u(!0),console.log("=== DEBUG START ==="),console.log("Tagihan ID:",s.tagihan.id),console.log("Route URL:",route("wali.payment.token",s.tagihan.id)),console.log("CSRF Token:",document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")),console.log("Window.snap exists:",!!window.snap);const n=await fetch(route("wali.payment.token",s.tagihan.id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},credentials:"include",body:JSON.stringify({tagihan_id:s.tagihan.id})});console.log("Response status:",n.status),console.log("Response OK:",n.ok);const t=await n.text();console.log("Raw response:",t);let c;try{c=JSON.parse(t),console.log("Parsed data:",c)}catch(l){console.error("Failed to parse JSON:",l),alert("Response bukan JSON valid: "+t);return}const d=c.snapToken;if(!d){console.error("❌ Snap token missing!"),alert("Token tidak ditemukan dalam response");return}console.log("✅ Snap token received:",d),window.snap?(console.log("✅ Opening Snap popup..."),window.snap.pay(d,{onSuccess:async l=>{console.log("Payment success:",l),alert("Pembayaran berhasil!"),await fetch(route("wali.payment.callback"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({order_id:l.order_id,status:l.transaction_status,gross_amount:l.gross_amount})}),P.reload()},onPending:l=>{console.log("Payment pending:",l),alert("Menunggu pembayaran...")},onError:l=>{console.error("Payment error:",l),alert("Pembayaran gagal!")},onClose:()=>{console.log("Payment popup closed"),alert("Kamu menutup popup tanpa menyelesaikan pembayaran")}})):(console.error("❌ Window.snap not available!"),alert("Snap belum siap. Coba refresh halaman."))}catch(n){console.error("❌ Error in handleBayar:",n),alert("Terjadi kesalahan: "+n.message)}finally{u(!1)}};return a.jsxs(O,{breadcrumbs:E,children:[a.jsx(S,{title:"Data Wali Murid"}),a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:[a.jsx("div",{className:"mb-4 flex items-center justify-between",children:a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Detail Tagihan"}),a.jsx("h2",{className:"text-sm text-muted-foreground",children:"Informasi lengkap tagihan siswa"})]})}),a.jsxs(R,{className:"bg-white p-4 shadow-sm",children:[a.jsxs("h1",{className:"text-xl font-bold capitalize",children:["Tagihan ",s.tagihan.siswa.nama]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"mb-4 flex items-center gap-4",children:[s.tagihan.siswa.foto?a.jsx("img",{src:`/storage/${s.tagihan.siswa.foto}`,alt:s.tagihan.siswa.nama,className:"h-40 w-36 rounded-md object-cover"}):a.jsx("img",{src:`https://ui-avatars.com/api/?name=${encodeURIComponent(s.tagihan.siswa.nama)}&background=random`,alt:s.tagihan.siswa.nama,className:"h-40 w-36 rounded-md object-cover"}),a.jsx(x,{className:"",children:a.jsxs(h,{children:[a.jsxs(r,{children:[a.jsx(e,{className:"font-medium text-gray-900",children:"NISN"}),a.jsxs(e,{className:"text-gray-900",children:[": ",s.tagihan.siswa.nisn]})]}),a.jsxs(r,{children:[a.jsx(e,{className:"font-medium text-gray-900",children:"Nama"}),a.jsxs(e,{className:"text-gray-900",children:[": ",s.tagihan.siswa.nama]})]}),a.jsxs(r,{children:[a.jsx(e,{className:"font-medium text-gray-900",children:"Kelas"}),a.jsxs(e,{className:"text-gray-900",children:[": ",s.tagihan.siswa.kelas]})]}),a.jsxs(r,{children:[a.jsx(e,{className:"font-medium text-gray-900",children:"Jurusan"}),a.jsxs(e,{className:"text-gray-900 uppercase",children:[": ",s.tagihan.siswa.jurusan]})]}),a.jsxs(r,{children:[a.jsx(e,{className:"font-medium text-gray-900",children:"Angkatan"}),a.jsxs(e,{className:"text-gray-900",children:[": ",s.tagihan.siswa.angkatan]})]})]})})]}),a.jsx("div",{children:a.jsx(x,{className:"",children:a.jsxs(h,{children:[a.jsxs(r,{children:[a.jsx(e,{className:"font-medium text-gray-900",children:"No. Tagihan"}),a.jsxs(e,{className:"text-gray-900",children:[": #SSG-",s.tagihan.id]})]}),a.jsxs(r,{children:[a.jsx(e,{className:"font-medium text-gray-900",children:"Tgl. Tagihan"}),a.jsxs(e,{className:"text-gray-900",children:[": ",y(s.tagihan.tanggal_tagihan)]})]}),a.jsxs(r,{children:[a.jsx(e,{className:"font-medium text-gray-900",children:"Tgl. Akhir Pembayaran"}),a.jsxs(e,{className:"text-gray-900",children:[": ",y(s.tagihan.tanggal_jatuh_tempo)]})]}),a.jsxs(r,{children:[a.jsx(e,{className:"font-medium text-gray-900",children:"Status Pembayaran"}),a.jsxs(e,{className:"text-gray-900 capitalize",children:[": ",s.tagihan.status]})]}),a.jsx(r,{children:a.jsx(e,{children:a.jsxs("a",{href:route("wali.tagihan.invoice",s.tagihan.id),className:"flex items-center",children:[a.jsx(B,{className:"mr-2 h-5 w-5 text-blue-500"})," ",a.jsx("span",{className:"text-blue-500",children:"Cetak Invoice Tagihan"})]})})})]})})})]}),a.jsxs(x,{className:"overflow-x-auto border",children:[a.jsx(C,{children:a.jsxs(r,{className:"border-b-2 border-gray-400 bg-gray-100 font-semibold",children:[a.jsx(e,{className:"border-e font-semibold text-gray-700 uppercase",children:"No"}),a.jsx(e,{className:"border-e font-semibold text-gray-700 uppercase",children:"Nama tagihan"}),a.jsx(e,{className:"w-60 text-end font-semibold text-gray-700 uppercase",children:"Jumlah Tagihan"})]})}),a.jsx(h,{children:i.length>0?i.map((n,t)=>a.jsxs(r,{className:"hover:bg-gray-50",children:[a.jsx(e,{className:"border-e text-gray-900",children:t+1}),a.jsx(e,{className:"border-e font-medium text-gray-900 capitalize",children:n.nama_biaya}),a.jsx(e,{className:"w-60 text-end text-gray-900",children:o(n.jumlah_biaya)})]},t)):a.jsx(r,{children:a.jsx(e,{colSpan:4,className:"py-4 text-center text-gray-500",children:"Belum ada Data Wali Murid"})})}),a.jsx(g,{children:a.jsxs(r,{className:"bg-red-100 font-semibold",children:[a.jsx(e,{className:"w-12"}),a.jsx(e,{className:"border-e text-center font-bold text-red-500 capitalize",children:"Sisa Belum Dibayar"}),a.jsx(e,{className:"text-end font-bold text-red-500",children:o(w)})]})}),i.length>0&&a.jsx(g,{children:a.jsxs(r,{className:"bg-gray-100 font-semibold",children:[a.jsx(e,{className:"w-12"}),a.jsx(e,{className:"border-e text-center font-bold text-gray-900 capitalize",children:"Total Pembayaran"}),a.jsx(e,{className:"text-end font-bold text-gray-900",children:o(i.reduce((n,t)=>n+t.jumlah_biaya,0))})]})}),a.jsx(g,{children:a.jsxs(r,{className:"bg-green-100 font-semibold",children:[a.jsx(e,{className:"w-12"}),a.jsx(e,{className:"border-e text-center font-bold text-green-700 capitalize",children:"Total Dibayarkan"}),a.jsx(e,{className:"text-end font-bold text-green-700",children:o(k)})]})})]}),a.jsxs("div",{className:"bg-gray-200 p-4",children:[a.jsx("h1",{className:"font-semibold",children:"Pembayaran Otomatis"}),a.jsxs("p",{className:"mt-2",children:["pembayaran otomatis pihak ketiga, anda akan dikenakan biaya tambahan (biaya admin) sebesar ",o(4e3)]}),s.tagihan.status!=="lunas"&&a.jsx("div",{className:"mt-2",children:a.jsx(N,{onClick:T,disabled:p||!j||s.tagihan.status==="lunas",children:p?"Memproses...":j?"Bayar Sekarang":"Loading..."})})]}),a.jsxs("div",{className:"bg-gray-200 p-4",children:["Pembayaran Bisa dilakukan dengan cara langsung ke Operator sekolah atau di trasnfer melalui rekening dibawah ini.",a.jsx("br",{}),a.jsx("u",{children:a.jsx("i",{children:" Jangan Melakukan transfer ke rekening selain dari rekening dibawah ini."})})," ",a.jsx("br",{}),"Setelah melakukan pembayaran, silahkan upload bukti pembayaran melalui tombol konfirmasi dibawah ini."]}),a.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:f.map((n,t)=>a.jsxs("div",{className:"bg-violet-200 p-4 text-violet-700",children:[a.jsx("table",{className:"mb-4",children:a.jsxs("tbody",{children:[a.jsxs("tr",{children:[a.jsx("td",{className:"md:w-40",children:"Bank Tujuan "}),a.jsxs("td",{className:"font-semibold",children:[" : ",n.nama_bank]})]}),a.jsxs("tr",{children:[a.jsx("td",{children:"Nama Rekening "}),a.jsxs("td",{className:"font-semibold",children:[" : ",n.nama_rekening]})]}),a.jsxs("tr",{children:[a.jsx("td",{children:"No Rekening "}),a.jsxs("td",{className:"font-semibold",children:[" : ",n.nomor_rekening]})]})]})}),s.tagihan.status!=="lunas"&&a.jsx(v,{href:route("wali.pembayaran.create",{tagihan_id:s.tagihan.id,bank_sekolah_id:n.id}),children:a.jsx(N,{variant:"default",children:"Konfirmasi Pembayaran"})})]},t))}),s.tagihan.status=="lunas"&&a.jsx("p",{className:"rounded-lg border border-green-300 bg-green-100 px-4 py-2 text-green-700 shadow-md",children:"✅ Pembayaran ini sudah Lunas"})]})]})]})};export{Q as default};
